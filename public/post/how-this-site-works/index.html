<!DOCTYPE html>
<html lang="en-gb"><head>
  <title>How this site works | Jack Reid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="https://jackreid.xyz/post/how-this-site-works/">
  
  <meta name="description" content="Note: There&rsquo;s a follow up to this because I&rsquo;ve since made more changes to the infrastructure of the site. Read more.
I’ve been slowly moving over to self-hosting more services and trying …">
  
  <link rel="icon" type="image/png" href="https://jackreid.xyz/favicon.png" />
  <link rel="apple-touch-icon" href="https://jackreid.xyz/favicon.png" type="image/png"/>
  <link rel="stylesheet" href="https://jackreid.xyz/css/style.css">
  <link rel="me" href="mailto:hello@jackreid.xyz"/>
  <link rel="manifest" href="/manifest.json"/>
  <meta name="author" content="Jack Reid"/>
  <meta name="robots" content="index,follow"/>
  <meta name="theme-color" content="#2C471F" />
  <meta name="supported-color-schemes" content="light dark"/>
  <meta property="og:site_name" content="Jack Reid" />
  <meta property="og:locale" content="en-gb" />
  <meta property="og:url" content="https://jackreid.xyz/post/how-this-site-works/" />
  <meta property="og:title" content="How this site works" />
  <meta property="og:type" content="article" />
  <meta name="twitter:site" content="@jackreid" />
  <meta name="twitter:creator" content="@jackreid" />
  
  <meta name="twitter:card" content="summary" />
  

  
    <meta name="twitter:description" content="Note: There&rsquo;s a follow up to this because I&rsquo;ve since made more changes to the …">
  
</head>
<body>


<div class="box-card-row">
  <header class="site-header box-card">
    <h1><a href="https://jackreid.xyz/">Jack Reid</a></h1>
    <nav>
      <ul>
        <li><a href="https://jackreid.xyz/post">Blog</a></li>
        <li><a href="https://jackreid.xyz/photo">Photos</a></li>
        <li><a href="https://jackreid.xyz/books/reading">Books</a></li>
        <li><a href="https://jackreid.xyz/films/watched">Films</a></li>
        <li><a href="https://jackreid.xyz/links">Links</a></li>
        <li><a href="https://jackreid.xyz/work">Work</a></li>
      </ul>
    </nav>
  </header>
  <section class="box-card photo-box">
    
      <a class="photo-box__link" href="https://jackreid.xyz/photo/7f9adf7bb361ca2013bc8bf9f90b6758/">
        <img class="photo-box__image" src="/img/photo/7f9adf7bb361ca2013bc8bf9f90b6758.jpg" alt="">
      </a>
    
  </section>
</div>
<div class="site-wrapper">
<main class="single-main">

  <h1 class="single-main__title">How this site works</h1>

  <p class="single-main__date">
    <svg height="12" width="12" viewBox="0 0 21 21" style="color: inherit;" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" transform="translate(2 2)"><path d="m2.5.5h12c1.1045695 0 2 .8954305 2 2v12c0 1.1045695-.8954305 2-2 2h-12c-1.1045695 0-2-.8954305-2-2v-12c0-1.1045695.8954305-2 2-2z" stroke="#2a2e3b" stroke-linecap="round" stroke-linejoin="round"/><path d="m.5 4.5h16" stroke="#2a2e3b" stroke-linecap="round" stroke-linejoin="round"/><g fill="#2a2e3b"><g><circle cx="8.5" cy="8.5" r="1"/><circle cx="4.5" cy="8.5" r="1"/><circle cx="12.5" cy="8.5" r="1"/></g><g><circle cx="8.5" cy="12.5" r="1"/><circle cx="4.5" cy="12.5" r="1"/><circle cx="12.5" cy="12.5" r="1"/></g></g></g></svg>

    2020-05-08
  </p>

  
  <p class="single-main__tags">
  
  <a href="https://jackreid.xyz/tags/dev/"><svg height="12" width="12" viewBox="0 0 21 21" style="color: inherit;" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" transform="translate(2 3)"><path d="m9.45405845.95405845h3.58578645c1.1045695 0 2 .8954305 2 2v3.58578644c0 .26521649-.1053568.5195704-.2928932.70710678l-7.29289325 7.29289323c-.78104858.7810486-2.04737854.7810486-2.82842712 0l-3.17157288-3.1715729c-.78104858-.7810486-.78104858-2.04737852 0-2.82842711l7.29289322-7.29289322c.18753638-.18753638.44189029-.29289322.70710678-.29289322z" stroke="#2a2e3b" stroke-linecap="round" stroke-linejoin="round"/><rect fill="#2a2e3b" height="2" rx="1" width="2" x="11.54" y="2.454"/></g></svg>
dev</a>
  
  <a href="https://jackreid.xyz/tags/tech/"><svg height="12" width="12" viewBox="0 0 21 21" style="color: inherit;" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" transform="translate(2 3)"><path d="m9.45405845.95405845h3.58578645c1.1045695 0 2 .8954305 2 2v3.58578644c0 .26521649-.1053568.5195704-.2928932.70710678l-7.29289325 7.29289323c-.78104858.7810486-2.04737854.7810486-2.82842712 0l-3.17157288-3.1715729c-.78104858-.7810486-.78104858-2.04737852 0-2.82842711l7.29289322-7.29289322c.18753638-.18753638.44189029-.29289322.70710678-.29289322z" stroke="#2a2e3b" stroke-linecap="round" stroke-linejoin="round"/><rect fill="#2a2e3b" height="2" rx="1" width="2" x="11.54" y="2.454"/></g></svg>
tech</a>
  
  <a href="https://jackreid.xyz/tags/indieweb/"><svg height="12" width="12" viewBox="0 0 21 21" style="color: inherit;" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" transform="translate(2 3)"><path d="m9.45405845.95405845h3.58578645c1.1045695 0 2 .8954305 2 2v3.58578644c0 .26521649-.1053568.5195704-.2928932.70710678l-7.29289325 7.29289323c-.78104858.7810486-2.04737854.7810486-2.82842712 0l-3.17157288-3.1715729c-.78104858-.7810486-.78104858-2.04737852 0-2.82842711l7.29289322-7.29289322c.18753638-.18753638.44189029-.29289322.70710678-.29289322z" stroke="#2a2e3b" stroke-linecap="round" stroke-linejoin="round"/><rect fill="#2a2e3b" height="2" rx="1" width="2" x="11.54" y="2.454"/></g></svg>
indieweb</a>
  
  <a href="https://jackreid.xyz/tags/web/"><svg height="12" width="12" viewBox="0 0 21 21" style="color: inherit;" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" transform="translate(2 3)"><path d="m9.45405845.95405845h3.58578645c1.1045695 0 2 .8954305 2 2v3.58578644c0 .26521649-.1053568.5195704-.2928932.70710678l-7.29289325 7.29289323c-.78104858.7810486-2.04737854.7810486-2.82842712 0l-3.17157288-3.1715729c-.78104858-.7810486-.78104858-2.04737852 0-2.82842711l7.29289322-7.29289322c.18753638-.18753638.44189029-.29289322.70710678-.29289322z" stroke="#2a2e3b" stroke-linecap="round" stroke-linejoin="round"/><rect fill="#2a2e3b" height="2" rx="1" width="2" x="11.54" y="2.454"/></g></svg>
web</a>
  
  </p>
  

  

  <div class="single-main__content">
    <p><em>Note:</em> There&rsquo;s a follow up to this because I&rsquo;ve since made more changes to the infrastructure of the site. <a href="/post/getting-off-of-netlify">Read more</a>.</p>
<p>I’ve been slowly moving over to self-hosting more services and trying to balance that with personal convenience. This post is a quick summary of the current setup I have running to do the following:</p>
<ul>
<li>Develop and run my personal website</li>
<li>Cross-post certain types of content from my website to Twitter</li>
<li>Periodically scrape a couple of proprietary services I use, to keep track of the media I’m consuming</li>
<li>Store and serve that data along with some other personal data in an API</li>
<li>Regularly update my personal website with the latest in my media consumption</li>
</ul>
<h2 id="personal-website">Personal website</h2>
<p>My website is built on <a href="https://gohugo.io/" title="Hugo">Hugo</a>, a static suite builder written in Go. I like that all the content on my website can be markdown files with some front-matter, any extra data can be in simple JSON files, and the template system is very simple. I’ve spent a lot of time tweaking and playing with this Hugo site, but really it would work just fine without much work at all.</p>
<p>The site is deployed to <a href="https://www.netlify.com/" title="Netlify">Netlify</a> for now. When I make changes in the website repo and push to master, it triggers a build in Netlify and the site is quickly updated, built, and deployed. Someday I might like to self-host this, I don’t think it’d be hard. But for now I like how easy this part of the flow is. I’ve also recently started using <a href="https://www.netlifycms.org/" title="Netlify CMS">Netlify CMS</a> and I like the way it’s just a convenient layer over the filesystem “CMS”. I’ve also built some simple forms that allow me to post notes and links from my phone, which has a text expansion shortcut for my GitHub token.</p>
<p>I don’t use any JavaScript on the site at the time of writing (other than a small library that allows me to login to Netlify CMS), nor do I use any CSS frameworks.</p>
<h2 id="cross-posting">Cross-posting</h2>
<p>Posts like this, highlights from the web, and notes (which are basically like cross-platform tweets) are all cross-posted from the website to Twitter. <a href="https://ifttt.com/" title="IFTTT">IFTTT</a> (If This, Then That) handles that by watching the RSS feeds Hugo automatically generates, composing a tweet based on a simple per-format template, and tweeting to my personal account. There are more IndieWeb ways to do this kind of thing, but I haven’t enjoyed working with <a href="https://brid.gy/" title="Bridgy">Bridgy</a> and the IndieWeb auth solutions thus far.</p>
<h2 id="scraping">Scraping</h2>
<p>I spend a lot of my life reading, watching, or listening to various forms of media. I keep track of what I’ve read or want to read, or what I’ve watched or want to watch - with a couple of proprietary services. I use <a href="https://www.goodreads.com/user/show/54047855-jack-reid" title="Goodreads">Goodreads</a> to track books, <a href="https://letterboxd.com/jackreid/" title="Letterboxd">Letterboxd</a> to track TV and film, and <a href="https://getpocket.com" title="Pocket">Pocket</a> to save articles. Each of these services is then scraped by a script I wrote every hour or so. The full history of my activity in each service is formatted and uploaded to a small Postgres database hosted by <a href="https://www.digitalocean.com/" title="DigitalOcean">DigitalOcean</a>.</p>
<p>This means I have a full, normalised record of all the media I’ve been consuming for at least two years. Not all of the scrapers are pretty, one relies on using Headless Chrome to download a .zip file from the GDPR compliance page of Letterboxd, for example. They do mean that I have an authoritative data source on what I’ve been up to, though. There is lots of prior art here from <a href="https://beepb00p.xyz/hpi.html" title="beepb00p">beepb00p</a>, who has a very advanced personal digital life scraping and representation project. Mine differs in a lot of ways, primarily in scope, but also the fact that I commit the cardinal sin of throwing away the original data files as-delivered, and normalise to a database.</p>
<p>The managed hosting Postgres hosted by DigitalOcean is probably overkill. I use very little of the allocation and its the most expensive standing cost of all of it. I do have some exported data from old Facebook messages and Google location history sitting in there ready to be used for something. My hope is the expensive overhead will motivate me to tinker with the database to make it worth my while.</p>
<h2 id="personal-api">Personal API</h2>
<p>The <a href="https://github.com/JackWReid/jackreidapi/tree/master/scripts" title="scraper scripts">scraper scripts</a>, <a href="https://github.com/JackWReid/jackreidapi/tree/master/api" title="a simple API">a simple API</a> to access the stored personal data, and a small monitoring stack for these processes, all sit on a $10 DigitalOcean droplet running Docker. The API is an Express server in a Docker container; each of the scrapers is a run-once Docker container that writes straight to the remote DB, and <a href="https://grafana.com/" title="Grafana">Grafana</a> and <a href="https://prometheus.io/" title="Prometheus">Prometheus</a> each run in their own Docker containers to collect and display metrics. All of this runs with one Docker Compose file with very little strain on the host. <a href="https://caddyserver.com/" title="Caddy">Caddy</a> then reverse-proxies all of this to the public internet.</p>
<p>Of course the Docker host gets very little strain because the API gets about .5rps. Pretty much the only consumer of the API is another script that periodically calls it to update my website with new data.</p>
<p>This API allows me to call up the books I’m currently reading according to Goodreads:</p>
<pre tabindex="0"><code>GET https://api.jackreid.xyz/books/reading
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;title&#34;</span>: <span style="color:#f1fa8c">&#34;Love of Country: A Hebridean Journey&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;author&#34;</span>: <span style="color:#f1fa8c">&#34;Madeleine Bunting&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;date_updated&#34;</span>: <span style="color:#f1fa8c">&#34;2020-05-05T12:13:25.000Z&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;title&#34;</span>: <span style="color:#f1fa8c">&#34;The Power Broker: Robert Moses and the Fall of New York&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;author&#34;</span>: <span style="color:#f1fa8c">&#34;Robert A. Caro&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;date_updated&#34;</span>: <span style="color:#f1fa8c">&#34;2020-04-16T05:06:51.000Z&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]</span></span></code></pre></div>
<h2 id="updating-the-website">Updating the website</h2>
<p>Because <a href="https://github.com/JackWReid/jackreid.xyz" title="this website">this website</a> is static, it won’t automatically call the API it renders a page. That’s good, because it means it can be nice and fast, but it means if I want it to show the latest in what I’m reading on the homepage I’ll have to regularly check for changes and re-build the site.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;[</span><span style="color:#ff79c6">$(</span>date<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">] Starting book and film data update&#34;</span>
</span></span><span style="display:flex;"><span>git checkout -f;
</span></span><span style="display:flex;"><span>git pull origin master;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Download latest data from API</span>
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/books/reading?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/books/reading.json;
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/books/toread?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/books/toread.json;
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/books/read?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/books/read.json;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/films/watched?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/films/watched.json;
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/films/towatch?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/films/towatch.json;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/pocket?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/pocket.json;
</span></span><span style="display:flex;"><span>curl -Lk https://api.jackreid.xyz/articles?limit<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> | jq . &gt; <span style="color:#8be9fd;font-style:italic">$PWD</span>/data/articles.json;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Update git</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;[</span><span style="color:#ff79c6">$(</span>date<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">] Committing updated media data files&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> -z <span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>git status --porcelain<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">]</span>; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;[</span><span style="color:#ff79c6">$(</span>date<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">] No changes found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;[</span><span style="color:#ff79c6">$(</span>date<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">] Changes found&#34;</span>
</span></span><span style="display:flex;"><span>	git add . <span style="color:#ff79c6">&amp;&amp;</span> git commit -m <span style="color:#f1fa8c">&#34;[</span><span style="color:#ff79c6">$(</span>date<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">] Updated media data files&#34;</span> <span style="color:#ff79c6">&amp;&amp;</span> git push origin master;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fi</span></span></span></code></pre></div>
<p>The DigitalOcean droplet also has a clone of my website repo. A cron job regularly runs <a href="https://github.com/JackWReid/jackreid.xyz/blob/master/scripts/update_media.sh" title="the above script">the above script</a> and calls all the relevant endpoints in my personal API, outputting the results into the <code>/data</code> directory of the Hugo site. If anything’s changed, it commits the updates to the data and pushes them so the updated version deploys. If not, do nothing.</p>
<p>In the end, a cron job is responsible for keeping all of this ticking. One task regularly makes sure the API and the scraper scripts are at the latest versions. Another runs all the scrapers that update the database every hour. Finally, one checks the API for new personal data and triggers the website to rebuild.</p>
<h2 id="conclusion">Conclusion</h2>
<p>All of this is horribly over-engineered, I know that. Really it’s a testing bed for me to try out things and to learn stuff I otherwise wouldn’t have to interact with as much: Docker, databases, monitoring stacks. The upside is I can have a nice and fast website that has all the latest information about what I’m watching. I’m leaning more and more into this retro-revival idea of having a single unified home online that represents me and that I am in control of, and this helps facilitate all of that.</p>

  </div>

<div class="see-also">
  <h2>See also</h2>
  <ul>
    
    <li><a href="/note/2020-01-28-tools-i-wish-existed/">Digital Tools I Wish Existed</a></li>
    
    <li><a href="/note/2020-02-10-files-going-extinct/">Computer Files Are Going Extinct</a></li>
    
    <li><a href="/highlight/low-tech-election-iowa/">The Only Safe Election Is a Low-Tech Election</a></li>
    
    <li><a href="/note/2019-12-31-pearshaped-magazine-archive/">PearShaped Magazine Archive</a></li>
    
    <li><a href="/note/2019-10-17-tech-sabbath/">Tech Sabbath</a></li>
    
  </ul>
</div>

</main>

    </div><footer class="site-footer">
  <p><a href="mailto:hello@jackreid.xyz">hello@jackreid.xyz</a> <a href="https://jackreid.xyz/rss">RSS</a></p>
  <p>9 Apr &#39;22, 11:24</p>
</footer>
</body>
</html>
